<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Staking KEY · Developers</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Overview"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Staking KEY · Developers"/><meta property="og:type" content="website"/><meta property="og:url" content="https://selfkeyfoundation.github.io/index.html"/><meta property="og:description" content="## Overview"/><meta property="og:image" content="https://selfkeyfoundation.github.io/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://selfkeyfoundation.github.io/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/obsidian.min.css"/><link rel="alternate" type="application/atom+xml" href="https://selfkeyfoundation.github.io/blog/atom.xml" title="Developers Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://selfkeyfoundation.github.io/blog/feed.xml" title="Developers Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Developers"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started/selfkey-intro.html" target="_self">Docs</a></li><li class=""><a href="/docs/resources/overview.html" target="_self">Resources</a></li><li class=""><a href="/en/help.html" target="_self">Help</a></li><li class=""><a href="/blog" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Additional Projects</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/getting-started/selfkey-intro.html">About SelfKey</a></li><li class="navListItem"><a class="navItem" href="/docs/getting-started/key-token-intro.html">KEY Token Contract</a></li><li class="navListItem"><a class="navItem" href="/docs/getting-started/idw-intro.html">SelfKey Identity Wallet</a></li><li class="navListItem"><a class="navItem" href="/docs/getting-started/skc-intro.html">SelfKey Connect (Browser Ext.)</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Marketplace Integrations</h3><ul><li class="navListItem"><a class="navItem" href="/docs/marketplace/marketplace-intro.html">About the Marketplace</a></li><li class="navListItem"><a class="navItem" href="/docs/marketplace/marketplace-api.html">Marketplace API</a></li><li class="navListItem"><a class="navItem" href="/docs/marketplace/marketplace-exchanges.html">Exchanges</a></li><li class="navListItem"><a class="navItem" href="/docs/marketplace/marketplace-incorporations.html">Incorporations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Login with SelfKey</h3><ul><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-intro.html">About Login with SelfKey</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-flow.html">Technical Flow Diagram</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-auth.html">Authentication Process</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-data.html">Data and Document Transfer</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-client.html">Client Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-server.html">Server Implementation</a></li><li class="navListItem"><a class="navItem" href="/docs/login-with-selfkey/lws-ux.html">User Experience</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Additional Projects</h3><ul><li class="navListItem"><a class="navItem" href="/docs/additional-projects/json-schema-intro.html">SelfKey JSON Schema</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/additional-projects/staking-intro.html">Staking KEY</a></li><li class="navListItem"><a class="navItem" href="/docs/additional-projects/did-intro.html">DID and Identity</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Staking KEY</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>The <code>StakingManager</code> contract provides the following functionality.</p>
<ol>
<li><p>Addresses are able to &quot;stake&quot; <em>KEY</em> linked to a given <em>Service Owner</em> address and a <em>serviceID</em> 32-byte string. This allows to reserve different amount of tokens simultaneously in relation to different services .</p></li>
<li><p>Staked tokens can only be retrieved by the original sender.</p></li>
<li><p>Any Ethereum address is able to associate itself with multiple &quot;serviceIDs&quot; through setting up custom parameters such as <strong>minimum stake</strong> and <strong>lock-in period</strong> per serviceID. This is done through the methods <code>setServiceMinimumStake</code> and <code>setServiceStakePeriod</code> respectively.</p></li>
<li><p>For the staking functionality to work, sender has to invoke <code>approve(stakingContractAddress, stakingAmount)</code> against on the <strong>token contract</strong> first, passing the staking contract address and
the corresponding staking amount (including all decimal places). This is to allow the staking contract to spend funds (up to the limit set) on behalf of its owner. After token spending approval,
<code>StakingManager</code> method <code>stake</code> can be invoked by passing an amount, a <em>serviceOnwer</em> address and a <em>serviceID</em>. For &quot;global&quot; services not tied to any particular service owner, the &quot;zero address&quot; can be used as the serviceOwner (i.e. <code>0x0000000000000000000000000000000000000000</code>).</p></li>
</ol>
<p>If multiple stakes need to be done, sender can make one big approval that sums up to the desired total stake amount.</p>
<h3><a class="anchor" aria-hidden="true" id="stakedaccess-contract-interface"></a><a href="#stakedaccess-contract-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>StakedAccess Contract Interface</h3>
<p>All staking functionality is implemented by the <code>StakingManager</code> contract, which includes the
following attributes:</p>
<h4><a class="anchor" aria-hidden="true" id="public-state-variables"></a><a href="#public-state-variables" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Public State Variables</h4>
<ul>
<li><p><code>balances[address][serviceOwner][serviceID]</code>: A mapping that stores all stake balances for each sender address for each different service under a serviceOwner address.</p></li>
<li><p><code>releaseDates[address][serviceOwner][serviceID]</code>: A mapping from addresses and bytes32 to a datetime in Unix format, representing the moment at which such stake can be released for a given service.</p></li>
<li><p><code>stakePeriods[serviceOwner][serviceID]:</code> The minimum amount of <em>days</em> that each stake should be locked for before allowing token retrieval for a given service.  Only the <em>serviceOwner</em> address can set this parameter.</p></li>
<li><p><code>stakeMinimum[serviceOwner][serviceID]:</code> The minimum amount of <em>tokens</em> (including decimal places) that a sender can stake for a given service. Only the <em>serviceOwner</em> address can set this parameter.</p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="public-functions"></a><a href="#public-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Public Functions</h4>
<ul>
<li><p><code>stake(amount, serviceOwner, serviceID)</code>: On invoking the <code>stake</code> function, an <code>amount</code> of tokens
is deducted from the sender address balance and added to the staking balance for a particular <code>serviceID</code> under a <code>serviceOwner</code> address. For the contract to be able to deduct tokens on behalf of the sender, sender <strong>must previously call the approve method of the token contract</strong> with at least the intended <code>amount</code>.</p></li>
<li><p><code>withdraw(serviceOwner, serviceID)</code>: a stake sender can invoke the <code>withdraw</code> function by specifying a <code>serviceOwner</code> and <code>serviceID</code>, in which case the <strong>total</strong> stake for that service is sent back to the sender's wallet. If a minimum period has been set priorly to the stake action, such withdrawal can only be made if present moment is beyond what's set on <code>releaseDates</code> for that particular stake.</p></li>
<li><p><code>hasStake(address, serviceOwner, serviceID)</code>: returns whether there's a stake made (greater than zero) by a sender on a particular service.</p></li>
<li><p><code>hasStakeAboveMinimum(address, serviceID)</code>: returns whether there's a stake made (greater than the current minimum) by a sender on a particular service.</p></li>
<li><p><code>setServiceStakePeriod(serviceID, amount)</code> <strong>(only service owner)</strong>: Stake lock-in period can be changed for any arbitrary <code>serviceID</code> under the caller's address. This does not affect stakes previously made.</p></li>
<li><p><code>setServiceMinimumStake(serviceID, amount)</code> <strong>(only service owner)</strong>: Minimum staking amount can
be changed for any arbitrary <code>serviceID</code> under the caller's address. This does not affect stakes previously made.</p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="events"></a><a href="#events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Events</h4>
<ul>
<li><p><code>KEYStaked(uint256 amount, address from, address serviceOwner, bytes32 serviceID)</code>: Emitted when
an address has successfully staked an amount of <em>KEY</em> to a particular service.</p></li>
<li><p><code>KEYStakeWithdrawn(uint256 amount, address from, address serviceOwner, bytes32 serviceID)</code>:
Emitted when a <em>KEY</em> owner has withdrawn tokens previously staked for a certain serviceID.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="development"></a><a href="#development" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development</h2>
<p>The smart contracts are being implemented in Solidity <code>0.4.23</code>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/additional-projects/json-schema-intro.html">← SelfKey JSON Schema</a><a class="docs-next button" href="/docs/additional-projects/did-intro.html">DID and Identity →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a><ul class="toc-headings"><li><a href="#stakedaccess-contract-interface">StakedAccess Contract Interface</a></li></ul></li><li><a href="#development">Development</a></li></ul></nav></div><footer class="nav-footer" id="footer"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Developers" height="60"/></a><section class="sitemap"><div><h5>Docs</h5><a href="/docs/en/selfkey-intro.html">Getting Started</a><a href="/docs/en/marketplace-intro.html">Marketplace Integration</a><a href="/docs/en/lws-intro.html">Login with Selfkey</a><a href="/docs/en/json-schema-intro.html">Additional Projects</a></div><div><h5>Resources</h5><a href="/en/resources.html">View All Resources</a><a href="/en/lws-nodejs.html">NodeJS SDK</a><a href="https://twitter.com/SelfKeyDevelopers" target="_blank" rel="noreferrer noopener">Selfkey Developer Twitter</a></div><div><h5>More</h5><a href="/blog">SelfKey Developer Blog</a><a href="https://github.com/SelfKeyFoundation">SelfKey GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/SelfKeyFoundation/Identity-Wallet" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 SelfKey Foundation</section></footer></div><script src="http://localhost:35729/livereload.js"></script></body></html>